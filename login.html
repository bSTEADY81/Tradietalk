
<!--
  login.html – Sign in to TradieTalk AI

  This page provides a simple login form for existing users. Credentials are
  validated against values stored in the browser's localStorage by the
  accompanying script.js.  If the credentials match, the user is
  redirected to the dashboard.  Otherwise, an error message is shown.

  For demonstration purposes only – this is not a secure authentication
  mechanism and should not be used in production.
-->
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sign In – TradieTalk AI</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="min-h-screen bg-blue-50 flex items-center justify-center">
    <div class="bg-white p-8 rounded shadow-md w-full max-w-md">
      <h1 class="text-2xl font-bold text-center mb-6">Sign In</h1>
      <form id="loginForm" class="space-y-4">
        <div>
          <label for="loginEmail" class="block text-sm font-medium text-gray-700">Email</label>
          <input id="loginEmail" type="email" required class="mt-1 w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" />
        </div>
        <div>
          <label for="loginPassword" class="block text-sm font-medium text-gray-700">Password</label>
          <input id="loginPassword" type="password" required class="mt-1 w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" />
        </div>
        <p id="loginError" class="hidden text-sm text-red-600">Invalid email or password.</p>
        <button type="submit" class="w-full py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition">Sign In</button>
      </form>
      <div class="mt-4 text-sm text-center space-y-2">
        <p>
          <a href="#" id="forgotPasswordLink" class="text-blue-600 hover:underline">Forgot your password?</a>
        </p>
        <p>
          Don't have an account?
          <a href="signup.html" class="text-blue-600 hover:underline">Sign up</a>
        </p>
      </div>
    </div>

    <!-- Forgot Password Modal -->
    <div id="forgotPasswordModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
      <div class="bg-white p-8 rounded shadow-lg w-full max-w-md mx-4">
        <h2 class="text-xl font-bold text-center mb-4">Reset Password</h2>
        <p class="text-sm text-gray-600 mb-4 text-center">Enter your email address and we'll send you a link to reset your password.</p>
        <form id="forgotPasswordForm" class="space-y-4">
          <div>
            <label for="resetEmail" class="block text-sm font-medium text-gray-700">Email</label>
            <input id="resetEmail" type="email" required class="mt-1 w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" />
          </div>
          <p id="resetMessage" class="hidden text-sm"></p>
          <div class="flex space-x-3">
            <button type="submit" id="sendResetBtn" class="flex-1 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition">Send Reset Link</button>
            <button type="button" id="cancelResetBtn" class="flex-1 py-2 bg-gray-300 text-gray-700 rounded hover:bg-gray-400 transition">Cancel</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Load Supabase client library.  It attaches a global `supabase` object used in script.js -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/supabase.umd.min.js"></script>
    <script src="script.js"></script>
    <script>
      // Attach login handler from script.js
      document.getElementById('loginForm').addEventListener('submit', function (e) {
        e.preventDefault();
        loginUser();
      });

      // Forgot password modal functionality
      const forgotPasswordLink = document.getElementById('forgotPasswordLink');
      const forgotPasswordModal = document.getElementById('forgotPasswordModal');
      const forgotPasswordForm = document.getElementById('forgotPasswordForm');
      const cancelResetBtn = document.getElementById('cancelResetBtn');
      const resetMessage = document.getElementById('resetMessage');
      const sendResetBtn = document.getElementById('sendResetBtn');

      // Show modal
      forgotPasswordLink.addEventListener('click', function(e) {
        e.preventDefault();
        forgotPasswordModal.classList.remove('hidden');
        document.getElementById('resetEmail').focus();
      });

      // Hide modal
      function hideModal() {
        forgotPasswordModal.classList.add('hidden');
        document.getElementById('resetEmail').value = '';
        resetMessage.classList.add('hidden');
        sendResetBtn.disabled = false;
        sendResetBtn.textContent = 'Send Reset Link';
      }

      cancelResetBtn.addEventListener('click', hideModal);

      // Close modal when clicking outside
      forgotPasswordModal.addEventListener('click', function(e) {
        if (e.target === forgotPasswordModal) {
          hideModal();
        }
      });

      // Handle forgot password form submission
      forgotPasswordForm.addEventListener('submit', function(e) {
        e.preventDefault();
        resetPassword();
      });
    </script>
  </body>
</html>
